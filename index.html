<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>منصة التحليل - OTC &amp; بوتات ذكية</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-messaging-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.2/lib/codemirror.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.2/mode/javascript/javascript.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.2/lib/codemirror.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    :root {
      --primary: #ff6b35;
      --dark: #1a1a2e;
      --light: #f7f9fc;
      --gradient: linear-gradient(135deg, #ff6b35, #d90429, #2b59c3);
      --shadow: 0 10px 30px rgba(255, 107, 53, 0.3);
      --neon: 0 0 15px rgba(255, 107, 53, 0.6);
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
      background-color: #0f0f1a;
      color: white;
      overflow-x: hidden;
      line-height: 1.7;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    .btn {
      display: inline-block;
      padding: 12px 28px;
      background: var(--gradient);
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      font-weight: 600;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
      text-decoration: none;
    }
    .btn:hover {
      transform: translateY(-3px);
      box-shadow: var(--neon);
    }
    .btn-outline {
      background: transparent;
      border: 2px solid var(--primary);
      color: var(--primary);
    }
    .btn-outline:hover {
      background: var(--primary);
      color: white;
    }
    section {
      padding: 80px 0;
      position: relative;
    }
    .hero {
      min-height: 100vh;
      display: flex;
      align-items: center;
      position: relative;
      overflow: hidden;
      background: url('https://placehold.co/1920x1080/111/333?text=Market+Analysis') no-repeat center center;
      background-size: cover;
    }
    .hero::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.7);
    }
    .hero-content {
      position: relative;
      z-index: 2;
      max-width: 800px;
    }
    .hero h1 {
      font-size: 3.5rem;
      margin-bottom: 20px;
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .hero p {
      font-size: 1.2rem;
      margin-bottom: 30px;
      opacity: 0.9;
    }
    .floating-bots {
      position: absolute;
      top: 20%;
      left: 10%;
      z-index: 1;
    }
    .bot {
      width: 60px;
      height: 60px;
      background: rgba(255,255,255,0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 20px 0;
      animation: float 6s ease-in-out infinite;
      box-shadow: var(--neon);
    }
    .bot:nth-child(2) { animation-delay: 2s; }
    .bot:nth-child(3) { animation-delay: 4s; }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }
    .nav-buttons {
      position: absolute;
      top: 30px;
      left: 30px;
      z-index: 10;
    }
    .why-us, .features, .indicators, .pricing, .testimonials, .faq, .contact {
      background: rgba(26, 26, 46, 0.6);
      backdrop-filter: blur(10px);
    }
    .section-title {
      text-align: center;
      margin-bottom: 50px;
      font-size: 2.5rem;
      color: var(--primary);
    }
    .cards {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      justify-content: center;
    }
    .card {
      background: rgba(255,255,255,0.1);
      border-radius: 15px;
      padding: 30px;
      width: 300px;
      text-align: center;
      transition: transform 0.3s ease;
      border: 1px solid rgba(255,107,53,0.3);
    }
    .card:hover {
      transform: translateY(-10px);
      box-shadow: var(--neon);
    }
    .card h3 {
      color: var(--primary);
      margin: 20px 0;
    }
    .card-img {
      width: 100%;
      height: 180px;
      overflow: hidden;
      border-radius: 15px;
      margin: 20px 0;
    }
    .card-img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.5s ease;
    }
    .card-img:hover img {
      transform: scale(1.1);
    }
    .pricing-cards {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 30px;
      margin-top: 40px;
    }
    .pricing-card {
      background: rgba(255,255,255,0.15);
      border: 2px solid var(--primary);
      border-radius: 20px;
      padding: 40px 30px;
      width: 320px;
      text-align: center;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    .pricing-card:hover {
      transform: scale(1.05);
      box-shadow: var(--neon);
    }
    .pricing-card.popular {
      transform: scale(1.1);
      border-color: #d90429;
    }
    .pricing-card.popular::before {
      content: "الأكثر شيوعاً";
      position: absolute;
      top: 15px;
      right: -30px;
      background: #d90429;
      color: white;
      padding: 5px 30px;
      transform: rotate(45deg);
      font-size: 0.9rem;
      font-weight: bold;
    }
    .pricing-card h3 {
      color: var(--primary);
      margin-bottom: 15px;
    }
    .price {
      font-size: 3rem;
      font-weight: bold;
      margin: 20px 0;
      color: #fff;
    }
    .features-list {
      list-style: none;
      margin: 25px 0;
    }
    .features-list li {
      padding: 10px 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .features-list li::before {
      content: "✓";
      color: var(--primary);
      margin-left: 10px;
    }
    .chat-widget {
      position: fixed;
      bottom: 30px;
      right: 30px;
      z-index: 1000;
    }
    .chat-btn {
      width: 60px;
      height: 60px;
      background: var(--gradient);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
      cursor: pointer;
      box-shadow: var(--neon);
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(255,107,53,0.7); }
      70% { box-shadow: 0 0 0 15px rgba(255,107,53,0); }
      100% { box-shadow: 0 0 0 0 rgba(255,107,53,0); }
    }
    .chat-window {
      position: fixed;
      bottom: 100px;
      right: 30px;
      width: 350px;
      height: 500px;
      background: rgba(26,26,46,0.95);
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
      backdrop-filter: blur(10px);
      overflow: hidden;
      display: none;
    }
    .chat-header {
      padding: 15px;
      background: rgba(255,107,53,0.2);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .chat-header h4 {
      margin: 0;
    }
    .chat-body {
      height: calc(100% - 120px);
      overflow-y: auto;
      padding: 15px;
    }
    .chat-footer {
      padding: 15px;
      border-top: 1px solid rgba(255,255,255,0.1);
      display: flex;
      gap: 10px;
    }
    .chat-footer input {
      flex: 1;
      padding: 10px;
      border-radius: 8px;
      border: none;
      background: rgba(255,255,255,0.1);
      color: white;
    }
    .chat-footer button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 8px;
      cursor: pointer;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: rgba(26,26,46,0.95);
      padding: 40px;
      border-radius: 20px;
      width: 90%;
      max-width: 500px;
      position: relative;
      backdrop-filter: blur(10px);
      max-height: 90vh;
      overflow-y: auto;
    }
    .close-modal {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 24px;
      cursor: pointer;
      color: #aaa;
    }
    .close-modal:hover {
      color: white;
    }
    .form-group {
      margin-bottom: 20px;
    }
    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #ccc;
    }
    .form-group input, .form-group select {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(255,255,255,0.1);
      color: white;
    }
    .form-group input:focus {
      outline: none;
      border-color: var(--primary);
    }
    .password-strength {
      margin-top: 8px;
      font-size: 0.9rem;
      color: #ff9900;
    }
    .password-strength.strong {
      color: #00cc66;
    }
    .password-strength.weak {
      color: #ff3300;
    }
    .terms {
      margin: 15px 0;
    }
    .terms input {
      margin-left: 10px;
      transform: scale(1.2);
    }
    .tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 1px solid rgba(255,255,255,0.2);
    }
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      border-bottom: 3px solid transparent;
    }
    .tab.active {
      border-bottom: 3px solid var(--primary);
      color: var(--primary);
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .notification-banner {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255,107,53,0.9);
      color: white;
      padding: 15px 30px;
      border-radius: 50px;
      z-index: 1000;
      box-shadow: var(--neon);
      animation: slideIn 0.5s ease, pulse 3s infinite 3s;
      white-space: nowrap;
    }
    @keyframes slideIn {
      from { transform: translateX(-50%) translateY(-50px); opacity: 0; }
      to { transform: translateX(-50%) translateY(0); opacity: 1; }
    }
    .dashboard {
      display: none;
      min-height: 100vh;
    }
    .dashboard-header {
      background: rgba(26,26,46,0.9);
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(255,107,53,0.3);
    }
    .user-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .user-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }
    .main-content {
      display: flex;
      height: calc(100vh - 80px);
    }
    .chart-container {
      flex: 1;
      background: #111;
      border: 1px solid rgba(255,107,53,0.3);
      border-radius: 10px;
      margin: 20px;
      position: relative;
    }
    .editor-container {
      width: 400px;
      background: rgba(26,26,46,0.9);
      border-radius: 10px;
      margin: 20px;
      display: flex;
      flex-direction: column;
    }
    .editor-header {
      padding: 15px;
      background: rgba(255,107,53,0.2);
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
    }
    .code-editor {
      flex: 1;
      padding: 10px;
    }
    .editor-footer {
      padding: 15px;
      display: flex;
      gap: 10px;
    }
    .quick-nav {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(26,26,46,0.9);
      padding: 10px;
      border-radius: 30px;
      display: none;
      gap: 15px;
      box-shadow: var(--shadow);
    }
    .quick-nav button {
      background: transparent;
      border: none;
      color: white;
      font-size: 18px;
      cursor: pointer;
    }
    .quick-nav button.active {
      color: var(--primary);
    }
    .footer {
      text-align: center;
      padding: 40px 0;
      background: rgba(10,10,20,0.8);
      margin-top: 80px;
    }
    .social-links {
      margin: 20px 0;
    }
    .social-links a {
      color: white;
      font-size: 24px;
      margin: 0 15px;
      transition: color 0.3s ease;
    }
    .social-links a:hover {
      color: var(--primary);
    }
    @media (max-width: 768px) {
      .hero h1 {
        font-size: 2.5rem;
      }
      .hero p {
        font-size: 1.1rem;
      }
      .pricing-card {
        width: 100%;
        margin: 10px 0;
      }
      .pricing-card.popular {
        transform: scale(1);
      }
      .chat-window {
        width: 90%;
        right: 5%;
        bottom: 80px;
        height: 400px;
      }
      .editor-container {
        width: 100%;
        height: 300px;
        position: fixed;
        bottom: 0;
        left: 0;
        border-radius: 15px 15px 0 0;
        transform: translateY(100%);
        transition: transform 0.3s ease;
      }
      .editor-container.show {
        transform: translateY(0);
      }
      .quick-nav {
        display: flex;
      }
    }
  </style>
</head>
<body>
  <!-- Notification Banner -->
  <div class="notification-banner">
    <i class="fas fa-bell"></i> انضم أكثر من 1,200 مستخدم نشط هذا الشهر!
  </div>

  <!-- Hero Section -->
  <section class="hero" id="home">
    <div class="floating-bots">
      <div class="bot"><i class="fas fa-robot"></i></div>
      <div class="bot"><i class="fas fa-chart-line"></i></div>
      <div class="bot"><i class="fas fa-brain"></i></div>
    </div>
    <div class="nav-buttons">
      <button class="btn btn-outline" onclick="openModal('loginModal')">تسجيل الدخول</button>
      <button class="btn" onclick="openModal('signupModal')">اشترك الآن</button>
    </div>
    <div class="container hero-content">
      <h1>منصة التحليل الذكية للأسواق OTC</h1>
      <p>استخدم أحدث المؤشرات والبوتات الذكية لتحليل الأسواق في الوقت الحقيقي. أكثر من 100 مؤشر جاهز، مكتبة أكواد، وبيئة تحليل احترافية.</p>
      <button class="btn" onclick="document.querySelector('.pricing').scrollIntoView({behavior: 'smooth'})">شاهد الخطط</button>
    </div>
  </section>

  <!-- Why Us -->
  <section class="why-us" id="why-us">
    <div class="container">
      <h2 class="section-title">لماذا نحن؟</h2>
      <div class="cards">
        <div class="card">
          <div class="card-img">
            <img src="https://placehold.co/300x180/222/444?text=Real-time+Data" alt="تحديثات فورية">
          </div>
          <i class="fas fa-bolt fa-3x" style="color:var(--primary)"></i>
          <h3>تحديثات فورية</h3>
          <p>بيانات حية بتحديثات كل 5 ثواني للفريمات القصيرة.</p>
        </div>
        <div class="card">
          <div class="card-img">
            <img src="https://placehold.co/300x180/333/555?text=Security" alt="آمن وموثوق">
          </div>
          <i class="fas fa-shield-alt fa-3x" style="color:var(--primary)"></i>
          <h3>آمن وموثوق</h3>
          <p>نظام تحقق مزدوج وحماية متقدمة للحسابات.</p>
        </div>
        <div class="card">
          <div class="card-img">
            <img src="https://placehold.co/300x180/222/444?text=AI+Bots" alt="بوتات ذكية">
          </div>
          <i class="fas fa-robot fa-3x" style="color:var(--primary)"></i>
          <h3>بوتات ذكية</h3>
          <p>مكتبة من البوتات المدربة على أنماط السوق المختلفة.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Features -->
  <section class="features" id="features">
    <div class="container">
      <h2 class="section-title">المميزات</h2>
      <div class="cards">
        <div class="card">
          <div class="card-img">
            <img src="https://placehold.co/300x180/333/555?text=Professional+Charts" alt="شارتات احترافية">
          </div>
          <i class="fas fa-chart-candle fa-3x" style="color:var(--primary)"></i>
          <h3>شارتات احترافية</h3>
          <p>دعم جميع أنواع الشارتات من 5 ثواني إلى 4 ساعات.</p>
        </div>
        <div class="card">
          <div class="card-img">
            <img src="https://placehold.co/300x180/222/444?text=Code+Editor" alt="محرر أكواد">
          </div>
          <i class="fas fa-code fa-3x" style="color:var(--primary)"></i>
          <h3>محرر أكواد</h3>
          <p>اكتب وشغل مؤشراتك الخاصة بلغة JavaScript.</p>
        </div>
        <div class="card">
          <div class="card-img">
            <img src="https://placehold.co/300x180/333/555?text=Indicator+Library" alt="مكتبة مؤشرات">
          </div>
          <i class="fas fa-book fa-3x" style="color:var(--primary)"></i>
          <h3>مكتبة مؤشرات</h3>
          <p>أكثر من 100 مؤشر احترافي جاهز للاستخدام الفوري.</p>
        </div>
        <div class="card">
          <div class="card-img">
            <img src="https://placehold.co/300x180/222/444?text=Support" alt="دعم مباشر">
          </div>
          <i class="fas fa-comments fa-3x" style="color:var(--primary)"></i>
          <h3>دعم مباشر</h3>
          <p>دردشة مباشرة مع الدعم الفني على مدار الساعة.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Indicators -->
  <section class="indicators" id="indicators">
    <div class="container">
      <h2 class="section-title">المؤشرات الجاهزة</h2>
      <p style="text-align:center; max-width: 800px; margin: 0 auto 40px;">
        أكثر من 100 مؤشر احترافي جاهز للاستخدام الفوري. ابحث، أضف إلى الشارت، أو استخدم كأساس لمؤشراتك الخاصة.
      </p>
      <div class="cards">
        <div class="card">
          <div class="card-img">
            <img src="https://placehold.co/300x180/333/555?text=RSI+Advanced" alt="RSI المتقدم">
          </div>
          <h3>RSI المتقدم</h3>
          <p>مؤشر قوة نسبية محسن مع إشارات دخول وخروج ذكية.</p>
        </div>
        <div class="card">
          <div class="card-img">
            <img src="https://placehold.co/300x180/222/444?text=AI+Bollinger" alt="Bollinger Bands AI">
          </div>
          <h3>Bollinger Bands AI</h3>
          <p>أشرطة بولينجر مع خوارزمية تعلم آلي للتنبؤ بالاختراقات.</p>
        </div>
        <div class="card">
          <div class="card-img">
            <img src="https://placehold.co/300x180/333/555?text=Volume+Profile" alt="Volume Profile Pro">
          </div>
          <h3>Volume Profile Pro</h3>
          <p>تحليل متقدم لحجم التداول مع تحديد مناطق السيولة.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Pricing -->
  <section class="pricing" id="pricing">
    <div class="container">
      <h2 class="section-title">خطط الاشتراك</h2>
      <p style="text-align:center; max-width: 800px; margin: 0 auto 40px;">
        اختر الخطة التي تناسب احتياجاتك وابدأ التحليل الفوري للأسواق.
      </p>
      <div class="pricing-cards">
        <div class="pricing-card">
          <h3>تجريبي مدفوع</h3>
          <div class="price">20$</div>
          <p>7 أيام</p>
          <ul class="features-list">
            <li>وصول كامل للمنصة</li>
            <li>100+ مؤشر جاهز</li>
            <li>محرر أكواد أساسي</li>
            <li>دعم محدود</li>
          </ul>
          <button class="btn" onclick="selectPlan('trial', 20)">اختر هذه الخطة</button>
        </div>
        <div class="pricing-card popular">
          <h3>شهري</h3>
          <div class="price">60$</div>
          <p>30 يوم</p>
          <ul class="features-list">
            <li>كل مميزات الخطة التجريبية</li>
            <li>بوتات ذكية</li>
            <li>دعم فني سريع</li>
            <li>تحديثات فورية</li>
          </ul>
          <button class="btn" onclick="selectPlan('monthly', 60)">اختر هذه الخطة</button>
        </div>
        <div class="pricing-card">
          <h3>بريميوم</h3>
          <div class="price">120$</div>
          <p>90 يوم</p>
          <ul class="features-list">
            <li>كل المميزات السابقة</li>
            <li>مؤشرات حصرية</li>
            <li>جلسات تدريب شخصية</li>
            <li>أولوية في الدعم</li>
          </ul>
          <button class="btn" onclick="selectPlan('premium', 120)">اختر هذه الخطة</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Testimonials -->
  <section class="testimonials" id="testimonials">
    <div class="container">
      <h2 class="section-title">آراء العملاء</h2>
      <div class="cards">
        <div class="card">
          <div class="card-img">
            <img src="https://placehold.co/300x180/222/444?text=User+Ahmed" alt="أحمد - متداول OTC">
          </div>
          <p>"المنصة غيرت طريقة تحليلي بالكامل. البوتات الذكية وفرت عليّ ساعات من المراقبة."</p>
          <p><strong>أحمد - متداول OTC</strong></p>
        </div>
        <div class="card">
          <div class="card-img">
            <img src="https://placehold.co/300x180/333/555?text=User+Sara" alt="سارة - محللة تقنية">
          </div>
          <p>"محرر الأكواد سهل الاستخدام وسمح لي بتطوير مؤشراتي الخاصة بسرعة كبيرة."</p>
          <p><strong>سارة - محللة تقنية</strong></p>
        </div>
      </div>
    </div>
  </section>

  <!-- FAQ -->
  <section class="faq" id="faq">
    <div class="container">
      <h2 class="section-title">الأسئلة الشائعة</h2>
      <div class="cards">
        <div class="card">
          <h3>كيف أبدأ؟</h3>
          <p>سجّل حساباً، اختر خطة اشتراك، وأرسل إثبات الدفع. بعد التحقق، ستتمكن من الدخول إلى لوحة التحليل.</p>
        </div>
        <div class="card">
          <h3>ما هي وسائل الدفع المقبولة؟</h3>
          <p>نقبل USDT، BTC، PayPal، والبطاقات الائتمانية من خلال بوابة آمنة.</p>
        </div>
        <div class="card">
          <h3>هل يمكنني تجربة المنصة مجاناً؟</h3>
          <p>نقدم خطة تجريبية مدفوعة لمدة 7 أيام لاختبار جميع الميزات.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Contact -->
  <section class="contact" id="contact">
    <div class="container">
      <h2 class="section-title">تواصل معنا</h2>
      <p style="text-align:center; margin-bottom: 30px;">لأي استفسار، تواصل معنا عبر القنوات التالية:</p>
      <div style="text-align:center;">
        <button class="btn" onclick="openModal('chatModal')">دردشة مباشرة</button>
      </div>
      <div class="social-links" style="margin-top:30px;">
        <a href="https://facebook.com/yourpage" target="_blank"><i class="fab fa-facebook"></i></a>
        <a href="https://instagram.com/yourpage" target="_blank"><i class="fab fa-instagram"></i></a>
        <a href="https://t.me/yourchannel" target="_blank"><i class="fab fa-telegram"></i></a>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <p>جميع الحقوق محفوظة © 2023 منصة التحليل الذكية</p>
      <div class="social-links">
        <a href="https://facebook.com/yourpage" target="_blank"><i class="fab fa-facebook"></i></a>
        <a href="https://instagram.com/yourpage" target="_blank"><i class="fab fa-instagram"></i></a>
        <a href="https://t.me/yourchannel" target="_blank"><i class="fab fa-telegram"></i></a>
        <a href="https://youtube.com/yourchannel" target="_blank"><i class="fab fa-youtube"></i></a>
      </div>
      <p>
        <a href="#" onclick="openModal('termsModal')">الشروط والأحكام</a> |
        <a href="#" onclick="openModal('privacyModal')">سياسة الخصوصية</a>
      </p>
    </div>
  </footer>

  <!-- Chat Widget -->
  <div class="chat-widget">
    <div class="chat-btn" onclick="toggleChat()">
      <i class="fas fa-comments"></i>
    </div>
    <div class="chat-window" id="chatWindow">
      <div class="chat-header">
        <h4>الدعم الفني</h4>
        <span id="closeChat" style="cursor:pointer;">✕</span>
      </div>
      <div class="chat-body">
        <div id="commonIssues">
          <h5>الحلول الشائعة:</h5>
          <details>
            <summary>كيف أرفع إثبات الدفع؟</summary>
            <p>انتقل إلى قسم "الاشتراكات"، اختر الخطة، ثم اضغط "إرسال إثبات الدفع" وارفع صورة واضحة للتحويل.</p>
          </details>
          <details>
            <summary>متى يتم تفعيل حسابي؟</summary>
            <p>بعد إرسال إثبات الدفع، يقوم الفريق بالتحقق خلال 24 ساعة وتفعيل حسابك.</p>
          </details>
        </div>
        <div id="chatMessages" style="margin-top:20px; display:none;">
          <!-- Messages will be added here -->
        </div>
      </div>
      <div class="chat-footer">
        <input type="text" id="messageInput" placeholder="اكتب رسالتك..." />
        <input type="file" id="fileInput" accept="image/*" style="display:none;" />
        <button onclick="document.getElementById('fileInput').click()" title="إرفاق صورة"><i class="fas fa-paperclip"></i></button>
        <button onclick="sendMessage()" title="إرسال"><i class="fas fa-paper-plane"></i></button>
      </div>
    </div>
  </div>

  <!-- Modals -->
  <!-- Sign Up Modal -->
  <div class="modal" id="signupModal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeModal('signupModal')">×</span>
      <h2 style="text-align:center; color:var(--primary); margin-bottom:30px;">إنشاء حساب جديد</h2>
      <div class="tabs">
        <div class="tab active" data-tab="email">البريد الإلكتروني</div>
        <div class="tab" data-tab="google">Google</div>
      </div>
      <div class="tab-content active" id="emailTab">
        <div class="form-group">
          <label for="signupName">الاسم الكامل</label>
          <input type="text" id="signupName" required />
        </div>
        <div class="form-group">
          <label for="signupEmail">البريد الإلكتروني</label>
          <input type="email" id="signupEmail" required />
        </div>
        <div class="form-group">
          <label for="signupPassword">كلمة المرور</label>
          <input type="password" id="signupPassword" required oninput="checkPasswordStrength()" />
          <div class="password-strength" id="passwordStrength">يجب أن تكون 12 حرفاً على الأقل، وتحتوي على حرف كبير، صغير، رقم، ورمز.</div>
        </div>
        <div class="form-group">
          <label for="confirmPassword">تأكيد كلمة المرور</label>
          <input type="password" id="confirmPassword" required oninput="validatePasswordsMatch()" />
          <div id="passwordMatch" style="margin-top:8px; font-size:0.9rem;"></div>
        </div>
        <div class="form-group">
          <label for="country">البلد (اختياري)</label>
          <input type="text" id="country" />
        </div>
        <div class="form-group">
          <label for="phone">رقم التواصل (اختياري)</label>
          <input type="tel" id="phone" />
        </div>
        <div class="terms">
          <input type="checkbox" id="acceptTerms" required onchange="toggleSignupButton()" />
          <label for="acceptTerms">أوافق على <a href="#" onclick="openModal('termsModal'); return false;">الشروط والأحكام</a> و <a href="#" onclick="openModal('privacyModal'); return false;">سياسة الخصوصية</a></label>
        </div>
        <button class="btn" id="signupBtn" disabled onclick="signUp()">إنشاء الحساب</button>
        <p style="text-align:center; margin-top:20px;">
          لديك حساب؟ <a href="#" onclick="switchToLogin()">تسجيل الدخول</a>
        </p>
      </div>
      <div class="tab-content" id="googleTab">
        <p style="text-align:center; margin:30px 0;">
          <button class="btn" onclick="googleSignUp()">
            <i class="fab fa-google"></i> 
            <span style="margin-right: 10px;">تسجيل الدخول بـ Google</span>
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c1/Google_%22G%22_logo.svg/768px-Google_%22G%22_logo.svg.png" 
                 alt="Google" style="width:24px; vertical-align:middle;">
          </button>
        </p>
      </div>
    </div>
  </div>

  <!-- Login Modal -->
  <div class="modal" id="loginModal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeModal('loginModal')">×</span>
      <h2 style="text-align:center; color:var(--primary); margin-bottom:30px;">تسجيل الدخول</h2>
      <div class="tabs">
        <div class="tab active" data-tab="email">البريد الإلكتروني</div>
        <div class="tab" data-tab="google">Google</div>
      </div>
      <div class="tab-content active" id="loginEmailTab">
        <div class="form-group">
          <label for="loginEmail">البريد الإلكتروني</label>
          <input type="email" id="loginEmail" required />
        </div>
        <div class="form-group">
          <label for="loginPassword">كلمة المرور</label>
          <input type="password" id="loginPassword" required />
        </div>
        <button class="btn" onclick="login()">تسجيل الدخول</button>
        <p style="text-align:center; margin-top:20px;">
          <a href="#" onclick="openModal('forgotModal')">نسيت كلمة المرور؟</a>
        </p>
        <p style="text-align:center; margin-top:20px;">
          ليس لديك حساب؟ <a href="#" onclick="switchToSignUp()">إنشاء حساب</a>
        </p>
      </div>
      <div class="tab-content" id="loginGoogleTab">
        <p style="text-align:center; margin:30px 0;">
          <button class="btn" onclick="googleLogin()">
            <i class="fab fa-google"></i> 
            <span style="margin-right: 10px;">تسجيل الدخول بـ Google</span>
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c1/Google_%22G%22_logo.svg/768px-Google_%22G%22_logo.svg.png" 
                 alt="Google" style="width:24px; vertical-align:middle;">
          </button>
        </p>
      </div>
    </div>
  </div>

  <!-- Payment Proof Modal -->
  <div class="modal" id="paymentModal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeModal('paymentModal')">×</span>
      <h2 style="text-align:center; color:var(--primary);">إكمال الدفع</h2>
      <p style="text-align:center; margin:20px 0;">لقد اخترت الخطة: <strong id="selectedPlan">-</strong> (<span id="planPrice">0</span>$)</p>
      <p style="text-align:center; margin:20px 0; background:rgba(255,255,255,0.1); padding:15px; border-radius:10px;">
        <strong>تعليمات الدفع:</strong><br>
        أرسل المبلغ إلى محفظة USDT (TRC20):<br>
        <code style="color:var(--primary);">THk...xyz</code><br>
        ثم أرسل لقطة الشاشة هنا.
      </p>
      <div class="form-group">
        <label for="proofImage">رفع إثبات الدفع (صورة)</label>
        <input type="file" id="proofImage" accept="image/*" required />
        <small>الملف يجب أن يكون صورة بحجم أقل من 10MB</small>
      </div>
      <button class="btn" onclick="submitPaymentProof()">إرسال طلب الدفع</button>
    </div>
  </div>

  <!-- Terms Modal -->
  <div class="modal" id="termsModal">
    <div class="modal-content" style="max-width:800px;">
      <span class="close-modal" onclick="closeModal('termsModal')">×</span>
      <h2 style="color:var(--primary); margin-bottom:20px;">الشروط والأحكام</h2>
      <div style="max-height:70vh; overflow-y:auto; padding-right:10px;">
        <p><strong>1. القبول</strong></p>
        <p>باستخدام منصتنا، أنت توافق على الالتزام بهذه الشروط. إذا كنت لا توافق، يُمنع استخدام الخدمة.</p>
        
        <p><strong>2. الحساب</strong></p>
        <p>يجب أن تكون المعلومات المقدمة دقيقة وكاملة. يحظر إنشاء حسابات متعددة بهدف التحايل على الاشتراكات.</p>
        
        <p><strong>3. الدفع</strong></p>
        <p>جميع المدفوعات غير قابلة للاسترداد. يتم تفعيل الحساب بعد التحقق من الدفع من قبل الإدارة.</p>
        
        <p><strong>4. الاستخدام</strong></p>
        <p>المنصة مخصصة لتحليل الأسواق فقط. يمنع استخدامها لأغراض غير قانونية أو انتهاك حقوق الملكية.</p>
        
        <p><strong>5. المسؤولية</strong></p>
        <p>نحن لا نضمن دقة التحليلات أو نتائج التداول. المستخدم مسؤول عن قراراته الاستثمارية.</p>
        
        <p><strong>6. التعديلات</strong></p>
        <p>نحتفظ بالحق في تعديل هذه الشروط في أي وقت. سيتم إشعار المستخدمين بالتغييرات المهمة.</p>
      </div>
    </div>
  </div>

  <!-- Privacy Modal -->
  <div class="modal" id="privacyModal">
    <div class="modal-content" style="max-width:800px;">
      <span class="close-modal" onclick="closeModal('privacyModal')">×</span>
      <h2 style="color:var(--primary); margin-bottom:20px;">سياسة الخصوصية</h2>
      <div style="max-height:70vh; overflow-y:auto; padding-right:10px;">
        <p><strong>1. جمع البيانات</strong></p>
        <p>نجمع معلوماتك عند التسجيل: الاسم، البريد، البلد، رقم التواصل (اختياري).</p>
        
        <p><strong>2. استخدام البيانات</strong></p>
        <p>نستخدم بياناتك لتوفير الخدمة، التحقق من الهوية، التواصل، وتحسين المنصة.</p>
        
        <p><strong>3. مشاركة البيانات</strong></p>
        <p>لا نبيع بياناتك أبداً. قد نشاركها مع جهات محدودة للتحقق من الدفع أو الدعم الفني.</p>
        
        <p><strong>4. الأمان</strong></p>
        <p>نستخدم تشفير SSL وتقنيات أمنية متقدمة لحماية بياناتك.</p>
        
        <p><strong>5. حقوقك</strong></p>
        <p>يمكنك طلب حذف حسابك وبياناتك في أي وقت عبر الدعم الفني.</p>
        
        <p><strong>6. الاتصال</strong></p>
        <p>لأي استفسار حول الخصوصية: <a href="mailto:privacy@analysisplatform.com" style="color:var(--primary);">privacy@analysisplatform.com</a></p>
      </div>
    </div>
  </div>

  <!-- Forgot Password Modal -->
  <div class="modal" id="forgotModal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeModal('forgotModal')">×</span>
      <h2 style="text-align:center; color:var(--primary);">إعادة تعيين كلمة المرور</h2>
      <p>أدخل بريدك الإلكتروني وسنرسل لك رابط إعادة التعيين.</p>
      <div class="form-group">
        <label for="resetEmail">البريد الإلكتروني</label>
        <input type="email" id="resetEmail" required />
      </div>
      <button class="btn" onclick="resetPassword()">إرسال الرابط</button>
    </div>
  </div>

  <!-- Dashboard -->
  <div class="dashboard" id="dashboard">
    <div class="dashboard-header">
      <h2>لوحة التحليل</h2>
      <div class="user-info">
        <div class="user-avatar" id="userAvatar">U</div>
        <div>
          <div id="userName">المستخدم</div>
          <div style="font-size:0.9rem; color:#ccc;" id="userSubscription">مشترك شهري - ينتهي في: --</div>
        </div>
      </div>
    </div>
    <div class="main-content">
      <div class="chart-container">
        <canvas id="chartCanvas" style="width:100%; height:100%;"></canvas>
      </div>
      <div class="editor-container" id="editorContainer">
        <div class="editor-header">
          <h4>محرر المؤشرات</h4>
        </div>
        <div class="code-editor" id="codeEditor"></div>
        <div class="editor-footer">
          <button class="btn" onclick="runIndicator()">تشغيل</button>
          <button class="btn btn-outline" onclick="saveIndicator()">حفظ</button>
        </div>
      </div>
    </div>
    <div class="quick-nav">
      <button onclick="showSection('chart')"><i class="fas fa-chart-line"></i></button>
      <button onclick="showSection('indicators')"><i class="fas fa-book"></i></button>
      <button onclick="showSection('bots')"><i class="fas fa-robot"></i></button>
      <button onclick="showSection('editor')" class="active"><i class="fas fa-code"></i></button>
      <button onclick="showSection('settings')"><i class="fas fa-cog"></i></button>
    </div>
  </div>

  <script>
    // Firebase Configuration - REPLACE IN PRODUCTION
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "your-project.firebaseapp.com",
      projectId: "your-project",
      storageBucket: "your-project.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();
    const messaging = firebase.messaging();

    // Request notification permission
    async function requestNotificationPermission() {
      try {
        const permission = await Notification.requestPermission();
        if (permission === 'granted') {
          const token = await messaging.getToken({
            vapidKey: 'YOUR_VAPID_KEY'
          });
          console.log('FCM Token:', token);
          // Save token to user document
          const user = auth.currentUser;
          if (user) {
            await db.collection('users').doc(user.uid).update({
              fcmToken: token
            });
          }
        }
      } catch (error) {
        console.log('Error getting FCM token:', error);
      }
    }

    // Handle incoming messages
    messaging.onMessage((payload) => {
      console.log('Message received: ', payload);
      showNotification(payload.notification.title + ': ' + payload.notification.body);
    });

    // Current selected plan
    let currentPlan = null;
    let currentUser = null;

    // Show notification
    function showNotification(message) {
      const notification = document.createElement('div');
      notification.className = 'notification-banner';
      notification.innerHTML = `<i class="fas fa-bell"></i> ${message}`;
      document.body.appendChild(notification);
      setTimeout(() => {
        notification.remove();
      }, 5000);
    }

    // Modal functions
    function openModal(modalId) {
      document.getElementById(modalId).style.display = 'flex';
    }

    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }

    // Tab switching in modals
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const parent = tab.closest('.modal-content');
        parent.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        parent.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        const tabName = tab.getAttribute('data-tab');
        parent.querySelector(`#${tabName}Tab`).classList.add('active');
      });
    });

    // Password strength check
    function checkPasswordStrength() {
      const password = document.getElementById('signupPassword').value;
      const strengthEl = document.getElementById('passwordStrength');
      let strength = 0;
      let message = '';
      let color = '';

      if (password.length >= 12) strength++;
      if (/[A-Z]/.test(password)) strength++;
      if (/[a-z]/.test(password)) strength++;
      if (/[0-9]/.test(password)) strength++;
      if (/[^A-Za-z0-9]/.test(password)) strength++;

      if (strength < 3) {
        message = 'كلمة المرور ضعيفة جداً';
        color = '#ff3300';
      } else if (strength < 5) {
        message = 'كلمة المرور متوسطة - أضف حرفاً كبيراً، صغيراً، رقماً ورمزاً';
        color = '#ff9900';
      } else {
        message = 'كلمة المرور قوية';
        color = '#00cc66';
      }

      strengthEl.textContent = message;
      strengthEl.className = 'password-strength';
      if (color) strengthEl.style.color = color;
      
      if (strength === 5) {
        strengthEl.classList.add('strong');
      } else {
        strengthEl.classList.add('weak');
      }

      validatePasswordsMatch();
    }

    // Validate password match
    function validatePasswordsMatch() {
      const password = document.getElementById('signupPassword').value;
      const confirm = document.getElementById('confirmPassword').value;
      const matchEl = document.getElementById('passwordMatch');
      
      if (confirm && password !== confirm) {
        matchEl.textContent = 'كلمتا المرور غير متطابقتين';
        matchEl.style.color = '#ff3300';
      } else if (confirm && password === confirm) {
        matchEl.textContent = 'كلمتا المرور متطابقتين';
        matchEl.style.color = '#00cc66';
      } else {
        matchEl.textContent = '';
      }
      
      toggleSignupButton();
    }

    // Toggle signup button
    function toggleSignupButton() {
      const password = document.getElementById('signupPassword').value;
      const confirm = document.getElementById('confirmPassword').value;
      const acceptTerms = document.getElementById('acceptTerms').checked;
      const btn = document.getElementById('signupBtn');
      
      let isStrong = false;
      if (password.length >= 12 && /[A-Z]/.test(password) && /[a-z]/.test(password) && /[0-9]/.test(password) && /[^A-Za-z0-9]/.test(password)) {
        isStrong = true;
      }
      
      if (password && confirm && acceptTerms && isStrong && password === confirm) {
        btn.disabled = false;
      } else {
        btn.disabled = true;
      }
    }

    // Switch between login and signup
    function switchToLogin() {
      closeModal('signupModal');
      openModal('loginModal');
    }

    function switchToSignUp() {
      closeModal('loginModal');
      openModal('signupModal');
    }

    // Sign up function
    async function signUp() {
      const name = document.getElementById('signupName').value;
      const email = document.getElementById('signupEmail').value;
      const password = document.getElementById('signupPassword').value;
      const country = document.getElementById('country').value;
      const phone = document.getElementById('phone').value;

      try {
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const user = userCredential.user;

        // Save user data to Firestore
        await db.collection('users').doc(user.uid).set({
          uid: user.uid,
          name: name,
          email: email,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          role: 'user',
          subscription: null,
          status: 'pending',
          country: country,
          phone: phone,
          fcmToken: null
        });

        // Send email verification
        await user.sendEmailVerification();

        showNotification('تم إنشاء الحساب! تحقق من بريدك لإكمال التسجيل.');
        closeModal('signupModal');
        
        // Reset form
        document.getElementById('signupName').value = '';
        document.getElementById('signupEmail').value = '';
        document.getElementById('signupPassword').value = '';
        document.getElementById('confirmPassword').value = '';
        document.getElementById('country').value = '';
        document.getElementById('phone').value = '';
        document.getElementById('acceptTerms').checked = false;
        
      } catch (error) {
        showNotification('خطأ: ' + error.message);
      }
    }

    // Google Sign Up
    async function googleSignUp() {
      const provider = new firebase.auth.GoogleAuthProvider();
      try {
        const result = await auth.signInWithPopup(provider);
        const user = result.user;
        
        // Check if this is a new user
        const userDoc = await db.collection('users').doc(user.uid).get();
        if (!userDoc.exists) {
          // New user - create profile
          await db.collection('users').doc(user.uid).set({
            uid: user.uid,
            name: user.displayName,
            email: user.email,
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            role: 'user',
            subscription: null,
            status: 'pending',
            fcmToken: null
          });
        }
        
        showNotification('تم تسجيل الدخول بنجاح!');
        closeModal('signupModal');
        checkAuthState();
        
      } catch (error) {
        showNotification('خطأ في تسجيل الدخول: ' + error.message);
      }
    }

    // Login function
    async function login() {
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;

      try {
        await auth.signInWithEmailAndPassword(email, password);
        showNotification('تم تسجيل الدخول بنجاح!');
        closeModal('loginModal');
      } catch (error) {
        showNotification('خطأ: ' + error.message);
      }
    }

    // Google Login
    async function googleLogin() {
      const provider = new firebase.auth.GoogleAuthProvider();
      try {
        await auth.signInWithPopup(provider);
        showNotification('تم تسجيل الدخول بنجاح!');
        closeModal('loginModal');
        checkAuthState();
      } catch (error) {
        showNotification('خطأ في تسجيل الدخول: ' + error.message);
      }
    }

    // Reset password
    async function resetPassword() {
      const email = document.getElementById('resetEmail').value;
      try {
        await auth.sendPasswordResetEmail(email);
        showNotification('تم إرسال رابط إعادة التعيين إلى بريدك الإلكتروني.');
        closeModal('forgotModal');
      } catch (error) {
        showNotification('خطأ: ' + error.message);
      }
    }

    // Select plan
    function selectPlan(plan, price) {
      currentPlan = { plan, price };
      document.getElementById('selectedPlan').textContent = 
        plan === 'trial' ? 'تجريبي مدفوع' :
        plan === 'monthly' ? 'شهري' : 'بريميوم';
      document.getElementById('planPrice').textContent = price;
      openModal('paymentModal');
    }

    // Submit payment proof
    async function submitPaymentProof() {
      const fileInput = document.getElementById('proofImage');
      const file = fileInput.files[0];
      
      if (!file) {
        showNotification('يرجى رفع صورة إثبات الدفع');
        return;
      }
      
      if (file.size > 10 * 1024 * 1024) {
        showNotification('حجم الصورة يجب أن يكون أقل من 10MB');
        return;
      }
      
      if (!currentPlan) {
        showNotification('يرجى اختيار خطة أولاً');
        return;
      }
      
      try {
        // Upload file to Firebase Storage
        const user = auth.currentUser;
        const timestamp = Date.now();
        const filePath = `payment_proofs/${user.uid}/${timestamp}.png`;
        const fileRef = storage.ref().child(filePath);
        
        await fileRef.put(file);
        const downloadURL = await fileRef.getDownloadURL();
        
        // Create payment record in Firestore
        await db.collection('payments').add({
          userId: user.uid,
          plan: currentPlan.plan,
          amount: currentPlan.price,
          currency: 'USD',
          proofURL: downloadURL,
          status: 'pending',
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        // Update user status to payment_pending
        await db.collection('users').doc(user.uid).update({
          status: 'payment_pending'
        });
        
        showNotification('تم إرسال طلب الدفع! سيتم التحقق من طلبك قريباً.');
        closeModal('paymentModal');
        
      } catch (error) {
        showNotification('خطأ في رفع الإثبات: ' + error.message);
      }
    }

    // Chat functions
    function toggleChat() {
      const chatWindow = document.getElementById('chatWindow');
      if (chatWindow.style.display === 'block') {
        chatWindow.style.display = 'none';
      } else {
        chatWindow.style.display = 'block';
        document.getElementById('commonIssues').style.display = 'block';
        document.getElementById('chatMessages').style.display = 'none';
      }
    }
    
    document.getElementById('closeChat').onclick = function() {
      document.getElementById('chatWindow').style.display = 'none';
    };

    async function sendMessage() {
      const messageInput = document.getElementById('messageInput');
      const fileInput = document.getElementById('fileInput');
      const message = messageInput.value.trim();
      const file = fileInput.files[0];
      const user = auth.currentUser;
      
      if (!user) {
        showNotification('يرجى تسجيل الدخول أولاً');
        return;
      }
      
      if (!message && !file) {
        showNotification('يرجى كتابة رسالة أو إرفاق ملف');
        return;
      }
      
      try {
        let attachmentURL = null;
        if (file) {
          if (file.size > 5 * 1024 * 1024) {
            showNotification('حجم الملف يجب أن يكون أقل من 5MB');
            return;
          }
          if (!file.type.startsWith('image/')) {
            showNotification('يرجى رفع صورة فقط');
            return;
          }
          
          const filePath = `chat_attachments/${user.uid}/${Date.now()}_${file.name}`;
          const fileRef = storage.ref().child(filePath);
          await fileRef.put(file);
          attachmentURL = await fileRef.getDownloadURL();
        }
        
        const messageData = {
          userId: user.uid,
          message: message,
          attachmentURL: attachmentURL,
          from: 'user',
          timestamp: firebase.firestore.FieldValue.serverTimestamp(),
          read: false
        };
        
        await db.collection('chats').add(messageData);
        
        messageInput.value = '';
        fileInput.value = '';
        showNotification('تم إرسال الرساله!');
        
        // Switch to messages view
        document.getElementById('commonIssues').style.display = 'none';
        document.getElementById('chatMessages').style.display = 'block';
        
      } catch (error) {
        showNotification('خطأ في إرسال الرسالة: ' + error.message);
      }
    }

    // Listen for chat messages
    function listenToChatMessages() {
      const user = auth.currentUser;
      if (!user) return;
      
      const chatMessagesRef = db.collection('chats')
        .where('userId', '==', user.uid)
        .orderBy('timestamp', 'desc');
      
      chatMessagesRef.onSnapshot(snapshot => {
        const messages = snapshot.docs.map(doc => ({
          id: doc.id,
          ...doc.data()
        }));
        
        // Update UI with messages
        const chatBody = document.querySelector('.chat-body');
        const messagesDiv = document.getElementById('chatMessages');
        
        if (messages.length > 0) {
          messagesDiv.innerHTML = '';
          messages.slice(0, 10).reverse().forEach(msg => {
            const msgEl = document.createElement('div');
            msgEl.style.padding = '10px';
            msgEl.style.margin = '5px 0';
            msgEl.style.backgroundColor = msg.from === 'user' ? 'rgba(255,255,255,0.1)' : 'rgba(255,107,53,0.2)';
            msgEl.style.borderRadius = '8px';
            
            if (msg.message) {
              msgEl.innerHTML += msg.message + '<br>';
            }
            
            if (msg.attachmentURL) {
              const img = document.createElement('img');
              img.src = msg.attachmentURL;
              img.style.maxWidth = '100%';
              img.style.borderRadius = '5px';
              img.style.marginTop = '5px';
              msgEl.appendChild(img);
            }
            
            msgEl.innerHTML += `<small style="color:#aaa; font-size:0.8rem;">${new Date(msg.timestamp?.toDate()).toLocaleString()}</small>`;
            messagesDiv.appendChild(msgEl);
          });
        }
      });
    }

    // Dashboard functions
    function showSection(section) {
      document.querySelectorAll('.quick-nav button').forEach(btn => {
        btn.classList.remove('active');
      });
      event.currentTarget.classList.add('active');
      
      if (section === 'editor') {
        document.getElementById('editorContainer').classList.add('show');
      } else {
        document.getElementById('editorContainer').classList.remove('show');
      }
    }

    // Run indicator
    function runIndicator() {
      const code = editor.getValue();
      try {
        // In a real app, this would run in a sandboxed environment
        const result = eval(code); // This is for demo only - never do this in production
        showNotification('تم تشغيل المؤشر بنجاح!');
      } catch (error) {
        showNotification('خطأ في الكود: ' + error.message);
      }
    }

    // Save indicator
    async function saveIndicator() {
      const user = auth.currentUser;
      if (!user) return;
      
      const code = editor.getValue();
      const name = prompt('أدخل اسم المؤشر:');
      if (!name) return;
      
      try {
        await db.collection('users').doc(user.uid).collection('indicators').add({
          name: name,
          code: code,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        showNotification('تم حفظ المؤشر بنجاح!');
      } catch (error) {
        showNotification('خطأ في الحفظ: ' + error.message);
      }
    }

    // Initialize CodeMirror
    let editor = null;
    document.addEventListener('DOMContentLoaded', () => {
      if (document.getElementById('codeEditor')) {
        editor = CodeMirror(document.getElementById('codeEditor'), {
          lineNumbers: true,
          mode: 'javascript',
          theme: 'monokai',
          value: `// مؤشر مثال: إشارات شراء عند تقاطع المتوسطات المتحركة
function myIndicator(candles) {
  // احسب المتوسط المتحرك البسيط 20 فترة
  const sma20 = candles.slice(-20).reduce((sum, c) => sum + c.c, 0) / 20;
  
  // احسب المتوسط المتحرك البسيط 50 فترة
  const sma50 = candles.slice(-50).reduce((sum, c) => sum + c.c, 0) / 50;
  
  const lastClose = candles[candles.length - 1].c;
  
  // تحقق من تقاطع صاعد
  if (lastClose > sma20 && sma20 > sma50) {
    return {
      signals: [{
        time: candles[candles.length - 1].t,
        type: 'buy',
        price: lastClose
      }],
      overlays: []
    };
  }
  
  return { signals: [], overlays: [] };
}`
        });
      }
      
      // Request notification permission
      if ('serviceWorker' in navigator && 'Notification' in window) {
        requestNotificationPermission();
      }
    });

    // Auth state observer
    auth.onAuthStateChanged(async (user) => {
      if (user) {
        currentUser = user;
        
        // Get user data
        const userDoc = await db.collection('users').doc(user.uid).get();
        if (userDoc.exists) {
          const userData = userDoc.data();
          
          // Update dashboard
          document.getElementById('userName').textContent = userData.name;
          document.getElementById('userAvatar').textContent = userData.name.charAt(0).toUpperCase();
          
          if (userData.subscription) {
            const expiresAt = userData.subscription.expiresAt?.toDate().toLocaleDateString() || 'غير محدد';
            document.getElementById('userSubscription').textContent = 
              \`مشترك \${userData.subscription.plan} - ينتهي في: \${expiresAt}\`;
          }
          
          // Show dashboard if active
          if (userData.status === 'active') {
            document.querySelector('.hero').style.display = 'none';
            document.querySelector('.dashboard').style.display = 'block';
            // Hide all sections except dashboard
            document.querySelectorAll('section').forEach(sec => {
              if (!sec.classList.contains('dashboard')) {
                sec.style.display = 'block';
              }
            });
          } else {
            showNotification('حالتكم: ' + (userData.status === 'pending' ? 'بانتظار التفعيل' : 'بانتظار التحقق من الدفع'));
          }
          
          // Start listening to chat messages
          listenToChatMessages();
        }
      } else {
        currentUser = null;
        document.querySelector('.dashboard').style.display = 'none';
        document.querySelector('.hero').style.display = 'flex';
        document.querySelectorAll('section').forEach(sec => {
          if (!sec.classList.contains('hero')) {
            sec.style.display = 'block';
          }
        });
      }
    });

    // Check auth state on page load
    checkAuthState();
    function checkAuthState() {
      const user = auth.currentUser;
      if (user) {
        // User is signed in
        currentUser = user;
      } else {
        // No user is signed in
        currentUser = null;
      }
    }

    // Mock chart data
    function generateMockData() {
      const data = [];
      const now = Date.now();
      const start = now - 30 * 60 * 1000; // 30 minutes ago
      let price = 1.1234;
      
      for (let t = start; t <= now; t += 5000) { // every 5 seconds
        const change = (Math.random() - 0.5) * 0.0005;
        price += change;
        const open = price - change/2;
        const high = Math.max(price, open) + Math.random() * 0.0002;
        const low = Math.min(price, open) - Math.random() * 0.0002;
        
        data.push({
          t: new Date(t).toISOString(),
          o: open,
          h: high,
          l: low,
          c: price,
          v: Math.floor(Math.random() * 1000) + 500
        });
      }
      
      return data;
    }

    // Simple chart rendering
    document.addEventListener('DOMContentLoaded', () => {
      const canvas = document.getElementById('chartCanvas');
      if (canvas) {
        const ctx = canvas.getContext('2d');
        const data = generateMockData();
        
        // Resize canvas
        function resize() {
          canvas.width = canvas.offsetWidth;
          canvas.height = canvas.offsetHeight;
          drawChart();
        }
        
        window.addEventListener('resize', resize);
        resize();
        
        function drawChart() {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          
          // Background
          ctx.fillStyle = '#111';
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          
          // Find min/max
          const prices = data.map(d => [d.o, d.h, d.l, d.c]).flat();
          const min = Math.min(...prices);
          const max = Math.max(...prices);
          const range = max - min;
          
          // Draw candles
          const barWidth = Math.max(2, canvas.width / data.length - 1);
          const padding = 50;
          
          data.forEach((d, i) => {
            const x = (i / data.length) * (canvas.width - 2*padding) + padding;
            const yOpen = canvas.height - ((d.o - min) / range) * (canvas.height - 2*padding) - padding;
            const yClose = canvas.height - ((d.c - min) / range) * (canvas.height - 2*padding) - padding;
            const yHigh = canvas.height - ((d.h - min) / range) * (canvas.height - 2*padding) - padding;
            const yLow = canvas.height - ((d.l - min) / range) * (canvas.height - 2*padding) - padding;
            
            // High-Low line
            ctx.strokeStyle = d.c >= d.o ? '#00cc66' : '#ff3300';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(x + barWidth/2, yHigh);
            ctx.lineTo(x + barWidth/2, yLow);
            ctx.stroke();
            
            // Open-Close bar
            ctx.fillStyle = d.c >= d.o ? '#00cc66' : '#ff3300';
            ctx.fillRect(x, Math.min(yOpen, yClose), barWidth, Math.abs(yClose - yOpen));
          });
          
          // Title
          ctx.fillStyle = 'white';
          ctx.font = '16px Arial';
          ctx.fillText('EUR/USD - الشموع اليابانية', padding, 30);
        }
        
        drawChart();
      }
    });

    // Auto-hide notification
    setTimeout(() => {
      const notification = document.querySelector('.notification-banner');
      if (notification) {
        notification.style.display = 'none';
      }
    }, 5000);

    // Smooth scrolling for navigation
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const targetId = this.getAttribute('href');
        if (targetId === '#') return;
        const targetElement = document.querySelector(targetId);
        if (targetElement) {
          targetElement.scrollIntoView({
            behavior: 'smooth'
          });
        }
      });
    });
  </script>
</body>
</html>
